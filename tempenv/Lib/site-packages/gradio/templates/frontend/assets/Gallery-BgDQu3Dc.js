import"./svelte/svelte_internal_flags_async.js";import*as e from"./svelte/svelte_internal_client.js";import{d as Qe,f as fe,E as Ye,e as Ze,I as K,D as $e,o as ge,p as et,q as _e}from"./ScrollFade-Df4eOX7N.js";import{S as tt}from"./ShareButton-c50NWbgM.js";import{F as lt}from"./FullscreenButton-D5DJ9370.js";import{M as rt,U as nt}from"./ModifyUpload-BBImu3IT.js";import{I as N}from"./Image-Bdf4wQSw.js";import"./ImagePreview-BoIZsleR.js";import{V as Q}from"./Video-BrnW2L40.js";import{d as it}from"./index-tFQomdd2.js";import{tick as at,onMount as ot}from"./svelte/svelte_svelte.js";import"./index-Iu0hi-Ff.js";import"./i18n-BSEU4Bba.js";import{u as st}from"./utils.svelte-kG009vb9.js";import"./svelte/svelte_events.js";import"./svelte/svelte_internal_flags_legacy.js";import"./MarkdownCode-B3eIh5Gl.js";import"./prism-python-BCCznRiZ.js";import"./svelte/svelte_animate.js";import"./svelte/svelte_attachments.js";import"./svelte/svelte_easing.js";import"./svelte/svelte_internal_flags_tracing.js";import"./svelte/svelte_internal_server.js";import"./svelte/svelte_legacy.js";import"./svelte/svelte_motion.js";import"./svelte/svelte_reactivity.js";import"./svelte/svelte_reactivity_window.js";import"./svelte/svelte_server.js";import"./svelte/svelte_store.js";import"./svelte/svelte_transition.js";async function dt(q){return q?`<div style="display: flex; flex-wrap: wrap; gap: 16px">${(await Promise.all(q.map(async([z,h])=>z===null||!z.url?"":await st(z.url)))).map(z=>`<img src="${z}" style="height: 400px" />`).join("")}</div>`:""}var ut=e.from_html('<div class="icon-button"><!></div>'),ct=e.from_html("<!> <!> <!> <!>",1),ft=e.from_html('<caption class="caption svelte-7anmrz"> </caption>'),gt=e.from_html("<!> <!>",1),_t=e.from_html("<button><!></button>"),mt=e.from_html('<span><!> <button class="media-button svelte-7anmrz" aria-label="detailed view of selected image"><!></button> <!> <div class="thumbnails scroll-hide svelte-7anmrz" data-testid="container_el"></div></span>'),vt=e.from_html("<!> <!>",1),pt=e.from_html('<div class="caption-label svelte-7anmrz"> </div>'),ht=e.from_html('<button class="delete-button svelte-7anmrz" aria-label="Delete image"><!></button>'),bt=e.from_html('<div class="gallery-item svelte-7anmrz"><button><!> <!></button> <!></div>'),wt=e.from_html('<div class="gallery-container"><!> <div><!> <div></div></div></div>'),yt=e.from_html("<!> <!>",1);function Yt(q,l){e.push(l,!0);let z=e.prop(l,"show_label",3,!0),h=e.prop(l,"value",15),me=e.prop(l,"columns",19,()=>[2]),ve=e.prop(l,"rows",3,void 0),G=e.prop(l,"height",3,"auto"),V=e.prop(l,"allow_preview",3,!0),pe=e.prop(l,"object_fit",3,"cover"),he=e.prop(l,"show_share_button",3,!1),be=e.prop(l,"show_download_button",3,!1),r=e.prop(l,"selected_index",15),we=e.prop(l,"show_fullscreen_button",3,!0),ye=e.prop(l,"fullscreen",3,!1),xe=e.prop(l,"root",3,""),ze=e.prop(l,"file_types",19,()=>["image","video"]),ke=e.prop(l,"max_file_size",3,null),Ie=e.prop(l,"fit_columns",3,!0),Le=e.prop(l,"buttons",3,null),Ee=e.prop(l,"oncustom_button_click",3,null),Me=e.prop(l,"onpreview_open",3,()=>{}),Pe=e.prop(l,"onchange",3,()=>{}),Ue=e.prop(l,"onclear",3,()=>{}),je=e.prop(l,"onselect",3,t=>{}),Be=e.prop(l,"onshare",3,t=>{}),Y=e.prop(l,"onerror",3,t=>{}),Z=e.prop(l,"onpreview_close",3,()=>{}),Re=e.prop(l,"onfullscreen",3,t=>{}),De=e.prop(l,"ondelete",3,()=>{}),Te=e.prop(l,"onupload",3,()=>{}),$=null,X="normal",Ae=!1,J=!1,ee,te=e.state(!1),o=e.derived(()=>h()==null?null:h().map(t=>"video"in t?{video:t.video,caption:t.caption}:"image"in t?{image:t.image,caption:t.caption}:{}));function Ce(t,i,u){if(t&&i&&u){const k=t.length;return Array.isArray(i)?i.map(m=>Math.min(m,k)):Math.min(i,k)}else return i}let We=e.derived(()=>Ce(e.get(o),me(),Ie())),le=e.state(e.proxy(h())),re=e.state(e.proxy(r()));e.user_effect(()=>{it(e.get(le),h())||(e.get(te)?(r(l.preview&&h()?.length?0:null),e.set(te,!1)):r()!==null&&h()!==null?r(Math.max(0,Math.min(r(),h().length-1))):r(null),Pe()(),e.set(le,h(),!0))});let ne=e.derived(()=>((r()??0)+(e.get(o)?.length??0)-1)%(e.get(o)?.length??0)),ie=e.derived(()=>((r()??0)+1)%(e.get(o)?.length??0));function Fe(t){const i=t.target,u=t.offsetX,m=i.offsetWidth/2;u<m?r(e.get(ne)):r(e.get(ie))}function qe(t){switch(t.code){case"Escape":t.preventDefault(),r(null),Z()();break;case"ArrowLeft":t.preventDefault(),r(e.get(ne));break;case"ArrowRight":t.preventDefault(),r(e.get(ie));break}}e.user_effect(()=>{r()!==e.get(re)&&(e.set(re,r(),!0),r()!==null&&(e.get(o)!=null&&r(Math.max(0,Math.min(r(),e.get(o).length-1))),je()({index:r(),value:e.get(o)?.[r()]})))}),e.user_effect(()=>{V()&&e.get(_)&&Ge(r())});let A=[],_=e.state(void 0);async function Ge(t){if(typeof t!="number"||(await at(),A[t]===void 0)||!e.get(_))return;A[t]?.focus();const{left:i,width:u}=e.get(_).getBoundingClientRect(),{left:k,width:m}=A[t].getBoundingClientRect(),E=k-i+m/2-u/2+e.get(_).scrollLeft;e.get(_)&&typeof e.get(_).scrollTo=="function"&&e.get(_).scrollTo({left:E<0?0:E,behavior:"smooth"})}async function He(t,i){let u;try{u=await l._fetch(t)}catch(E){if(E instanceof TypeError){window.open(t,"_blank","noreferrer");return}throw E}const k=await u.blob(),m=URL.createObjectURL(k),U=document.createElement("a");U.href=m,U.download=i,U.click(),URL.revokeObjectURL(m)}let g=e.derived(()=>r()!=null&&e.get(o)!=null?e.get(o)[r()]:null),ae=!1;function C(){e.get(_)&&(ae=e.get(_).scrollWidth>e.get(_).clientWidth)}ot(()=>(C(),document.addEventListener("fullscreenchange",()=>{J=!!document.fullscreenElement}),window.addEventListener("resize",C),()=>window.removeEventListener("resize",C))),e.user_effect(()=>{e.get(o),C(),e.get(_)&&C()});function Oe(t){if(!h()||!e.get(o))return;const i=e.get(o)[t];let u;"image"in i?u={file:i.image,index:t}:"video"in i&&(u={file:i.video,index:t}),u&&De()(u)}let oe=!1;var se=yt(),de=e.first_child(se);{var Se=t=>{{let i=e.derived(()=>l.label||"Gallery");Qe(t,{get show_label(){return z()},get Icon(){return fe},get label(){return e.get(i)}})}};e.if(de,t=>{z()&&t(Se)})}var Ve=e.sibling(de,2);{var Xe=t=>{Ye(t,{unpadded_box:!0,size:"large",children:(i,u)=>{fe(i)},$$slots:{default:!0}})},Je=t=>{var i=wt(),u=e.child(i);{var k=y=>{var c=mt();e.set_class(c,1,"preview svelte-7anmrz",null,{},{minimal:X==="minimal"});var I=e.child(c);Ze(I,{display_top_corner:Ae,get buttons(){return Le()},get on_custom_button_click(){return Ee()},children:(n,s)=>{var v=ct(),a=e.first_child(v);{var d=f=>{{let L=e.derived(()=>l.i18n("common.download"));K(f,{get Icon(){return $e},get label(){return e.get(L)},onclick:()=>{const S="image"in e.get(g)?e.get(g)?.image:e.get(g)?.video;if(S==null)return;const{url:T,orig_name:Ne}=S;T&&He(T,Ne??"image")}})}};e.if(a,f=>{be()&&f(d)})}var p=e.sibling(a,2);{var F=f=>{lt(f,{get fullscreen(){return ye()},$$events:{fullscreen:L=>Re()(L)}})};e.if(p,f=>{we()&&f(F)})}var D=e.sibling(p,2);{var w=f=>{var L=ut(),S=e.child(L);tt(S,{get i18n(){return l.i18n},get value(){return e.get(o)},get formatter(){return dt},$$events:{share:T=>{Be()(T)},error:T=>{Y()(T)}}}),e.reset(L),e.append(f,L)};e.if(D,f=>{he()&&f(w)})}var P=e.sibling(D,2);{var O=f=>{K(f,{get Icon(){return ge},label:"Close",onclick:()=>{r(null),Z()()}})};e.if(P,f=>{J||f(O)})}e.append(n,v)},$$slots:{default:!0}});var b=e.sibling(I,2),x=e.child(b);{var B=n=>{{let s=e.derived(()=>({alt:e.get(g).caption||"",title:e.get(g).caption||null,class:e.get(g).caption&&"with-caption",loading:"lazy"}));N(n,{get restProps(){return e.get(s)},get src(){return e.get(g).image.url},data_testid:"detailed-image"})}},M=n=>{{let s=e.derived(()=>e.get(g).caption||"");Q(n,{get src(){return e.get(g).video.url},"data-testid":"detailed-video",get alt(){return e.get(s)},loading:"lazy",loop:!1,is_stream:!1,muted:!1,controls:!0})}};e.if(x,n=>{"image"in e.get(g)?n(B):n(M,!1)})}e.reset(b);var R=e.sibling(b,2);{var W=n=>{var s=ft(),v=e.child(s,!0);e.reset(s),e.template_effect(()=>e.set_text(v,e.get(g).caption)),e.append(n,s)};e.if(R,n=>{e.get(g)?.caption&&n(W)})}var j=e.sibling(R,2);e.each(j,21,()=>e.get(o),e.index,(n,s,v)=>{var a=_t();let d;var p=e.child(a);{var F=w=>{{let P=e.derived(()=>({title:e.get(s).caption||null,alt:"",class:"with-caption",loading:"lazy"}));N(w,{get src(){return e.get(s).image.url},get restProps(){return e.get(P)},data_testid:`thumbnail ${v+1}`})}},D=w=>{var P=gt(),O=e.first_child(P);_e(O);var f=e.sibling(O,2);{let L=e.derived(()=>e.get(s).caption||null);Q(f,{get src(){return e.get(s).video.url},get title(){return e.get(L)},is_stream:!1,"data-testid":"thumbnail "+(v+1),alt:"",loading:"lazy",loop:!1})}e.append(w,P)};e.if(p,w=>{"image"in e.get(s)?w(F):w(D,!1)})}e.reset(a),e.bind_this(a,(w,P)=>A[P]=w,w=>A?.[w],()=>[v]),e.template_effect(()=>{d=e.set_class(a,1,"thumbnail-item thumbnail-small svelte-7anmrz",null,d,{selected:r()===v&&X!=="minimal"}),e.set_attribute(a,"aria-label","Thumbnail "+(v+1)+" of "+e.get(o).length)}),e.event("click",a,()=>r(v)),e.append(n,a)}),e.reset(j),e.bind_this(j,n=>e.set(_,n),()=>e.get(_)),e.reset(c),e.template_effect(()=>{e.set_style(b,`height: calc(100% - ${e.get(g).caption?"80px":"60px"})`),e.set_style(j,`justify-content: ${ae?"flex-start":"center"};`)}),e.event("click",b,function(...n){("image"in e.get(g)?s=>Fe(s):null)?.apply(this,n)}),e.event("keydown",c,qe),e.append(y,c)};e.if(u,y=>{e.get(g)&&V()&&y(k)})}var m=e.sibling(u,2);let U,E;var ue=e.child(m);{var Ke=y=>{rt(y,{get i18n(){return l.i18n},onclear:()=>{h([]),Ue()()},children:(c,I)=>{var b=e.comment(),x=e.first_child(b);{var B=M=>{{let R=e.derived(()=>l.i18n("upload_text.click_to_upload"));K(M,{get Icon(){return et},get label(){return e.get(R)},children:(W,j)=>{nt(W,{icon_upload:!0,onload:n=>Te()(n),get filetype(){return ze()},file_count:"multiple",get max_file_size(){return ke()},get root(){return xe()},onerror:n=>Y()(n),get stream_handler(){return l.stream_handler},get upload(){return l.upload},get upload_promise(){return $},set upload_promise(n){$=n},get uploading(){return oe},set uploading(n){oe=n}})},$$slots:{default:!0}})}};e.if(x,M=>{l.upload&&l.stream_handler&&M(B)})}e.append(c,b)},$$slots:{default:!0}})};e.if(ue,y=>{l.interactive&&r()===null&&y(Ke)})}var H=e.sibling(ue,2);let ce;e.each(H,21,()=>e.get(o),e.index,(y,c,I)=>{var b=bt(),x=e.child(b);let B;var M=e.child(x);{var R=a=>{{let d=e.derived(()=>e.get(c).caption||""),p=e.derived(()=>typeof e.get(c).image=="string"?e.get(c).image:e.get(c).image.url);N(a,{get alt(){return e.get(d)},get src(){return e.get(p)},loading:"lazy"})}},W=a=>{var d=vt(),p=e.first_child(d);_e(p);var F=e.sibling(p,2);{let D=e.derived(()=>e.get(c).caption||null);Q(F,{get src(){return e.get(c).video.url},get title(){return e.get(D)},is_stream:!1,"data-testid":"thumbnail "+(I+1),alt:"",loading:"lazy",loop:!1})}e.append(a,d)};e.if(M,a=>{"image"in e.get(c)?a(R):a(W,!1)})}var j=e.sibling(M,2);{var n=a=>{var d=pt(),p=e.child(d,!0);e.reset(d),e.template_effect(()=>e.set_text(p,e.get(c).caption)),e.append(a,d)};e.if(j,a=>{e.get(c).caption&&a(n)})}e.reset(x);var s=e.sibling(x,2);{var v=a=>{var d=ht(),p=e.child(d);ge(p),e.reset(d),e.event("click",d,e.stopPropagation(()=>Oe(I))),e.append(a,d)};e.if(s,a=>{l.interactive&&a(v)})}e.reset(b),e.template_effect(()=>{B=e.set_class(x,1,"thumbnail-item thumbnail-lg svelte-7anmrz",null,B,{selected:r()===I}),e.set_attribute(x,"aria-label","Thumbnail "+(I+1)+" of "+e.get(o).length)}),e.event("click",x,()=>{r()===null&&V()&&Me()(),r(I)}),e.append(y,b)}),e.reset(H),e.reset(m),e.reset(i),e.bind_this(i,y=>ee=y,()=>ee),e.template_effect(()=>{U=e.set_class(m,1,"grid-wrap svelte-7anmrz",null,U,{minimal:X==="minimal","fixed-height":!G()||G()=="auto",hidden:J}),E=e.set_style(m,"",E,{height:G()!=="auto"?G()+"px":null}),ce=e.set_class(H,1,"grid-container svelte-7anmrz",null,ce,{"pt-6":z()}),e.set_style(H,`--grid-cols:${e.get(We)??""}; --grid-rows:${ve()??""}; --object-fit: ${pe()??""};`)}),e.append(t,i)};e.if(Ve,t=>{h()==null||e.get(o)==null||e.get(o).length===0?t(Xe):t(Je,!1)})}e.bind_window_size("innerHeight",t=>t),e.append(q,se),e.pop()}export{Yt as default};
