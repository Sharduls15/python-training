const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./module-C85Cvh0Z.js","./module-DoWOc2fJ.js","./module-B5lWqP2v.js"])))=>i.map(i=>d[i]);
import"./svelte/svelte_internal_flags_async.js";import*as e from"./svelte/svelte_internal_client.js";import{onMount as le,onDestroy as Ee,tick as Ce}from"./svelte/svelte_svelte.js";import"./i18n-BSEU4Bba.js";import{f as de,u as Fe,G as ze}from"./utils.svelte-kG009vb9.js";import{a as qe,S as ke}from"./StreamingBar-Ck4VV0Q5.js";import{s as We,W as Ne,u as Re,p as De,A as He,S as Ge}from"./StaticAudio-CrG63HUl.js";import{M as Pe,U as Ve}from"./ModifyUpload-BBImu3IT.js";import{_ as Se,p as Ye}from"./index-Iu0hi-Ff.js";import{Y as Je,O as Ke,d as Qe,H as Xe,t as Ze,a2 as $e,B as Ae,U as et}from"./ScrollFade-Df4eOX7N.js";import{S as tt}from"./ShareButton-c50NWbgM.js";import"./svelte/svelte_internal_flags_legacy.js";function ye(I,t,i,a){return new(i||(i=Promise))((function(m,r){function d(s){try{o(a.next(s))}catch(c){r(c)}}function n(s){try{o(a.throw(s))}catch(c){r(c)}}function o(s){var c;s.done?m(s.value):(c=s.value,c instanceof i?c:new i((function(g){g(c)}))).then(d,n)}o((a=a.apply(I,[])).next())}))}class Be{constructor(){this.listeners={}}on(t,i,a){if(this.listeners[t]||(this.listeners[t]=new Set),a?.once){const m=(...r)=>{this.un(t,m),i(...r)};return this.listeners[t].add(m),()=>this.un(t,m)}return this.listeners[t].add(i),()=>this.un(t,i)}un(t,i){var a;(a=this.listeners[t])===null||a===void 0||a.delete(i)}once(t,i){return this.on(t,i,{once:!0})}unAll(){this.listeners={}}emit(t,...i){this.listeners[t]&&this.listeners[t].forEach((a=>a(...i)))}}class rt extends Be{constructor(t){super(),this.subscriptions=[],this.isDestroyed=!1,this.options=t}onInit(){}_init(t){this.isDestroyed&&(this.subscriptions=[],this.isDestroyed=!1),this.wavesurfer=t,this.onInit()}destroy(){this.emit("destroy"),this.subscriptions.forEach((t=>t())),this.subscriptions=[],this.isDestroyed=!0,this.wavesurfer=void 0}}class it extends Be{constructor(){super(...arguments),this.animationFrameId=null,this.isRunning=!1}start(){if(this.isRunning)return;this.isRunning=!0;const t=()=>{this.isRunning&&(this.emit("tick"),this.animationFrameId=requestAnimationFrame(t))};t()}stop(){this.isRunning=!1,this.animationFrameId!==null&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}destroy(){this.stop()}}const at=["audio/webm","audio/wav","audio/mpeg","audio/mp4","audio/mp3"];class ce extends rt{constructor(t){var i,a,m,r,d,n;super(Object.assign(Object.assign({},t),{audioBitsPerSecond:(i=t.audioBitsPerSecond)!==null&&i!==void 0?i:128e3,scrollingWaveform:(a=t.scrollingWaveform)!==null&&a!==void 0&&a,scrollingWaveformWindow:(m=t.scrollingWaveformWindow)!==null&&m!==void 0?m:5,continuousWaveform:(r=t.continuousWaveform)!==null&&r!==void 0&&r,renderRecordedAudio:(d=t.renderRecordedAudio)===null||d===void 0||d,mediaRecorderTimeslice:(n=t.mediaRecorderTimeslice)!==null&&n!==void 0?n:void 0})),this.stream=null,this.mediaRecorder=null,this.dataWindow=null,this.isWaveformPaused=!1,this.lastStartTime=0,this.lastDuration=0,this.duration=0,this.micStream=null,this.recordedBlobUrl=null,this.timer=new it,this.subscriptions.push(this.timer.on("tick",(()=>{const o=performance.now()-this.lastStartTime;this.duration=this.isPaused()?this.duration:this.lastDuration+o,this.emit("record-progress",this.duration)})))}static create(t){return new ce(t||{})}renderMicStream(t){var i;const a=new AudioContext,m=a.createMediaStreamSource(t),r=a.createAnalyser();m.connect(r),this.options.continuousWaveform&&(r.fftSize=32);const d=r.frequencyBinCount,n=new Float32Array(d);let o=0;this.wavesurfer&&((i=this.originalOptions)!==null&&i!==void 0||(this.originalOptions=Object.assign({},this.wavesurfer.options)),this.wavesurfer.options.interact=!1,this.options.scrollingWaveform&&(this.wavesurfer.options.cursorWidth=0));const s=setInterval((()=>{var c,g,_,k;if(!this.isWaveformPaused){if(r.getFloatTimeDomainData(n),this.options.scrollingWaveform){const v=Math.floor((this.options.scrollingWaveformWindow||0)*a.sampleRate),p=Math.min(v,this.dataWindow?this.dataWindow.length+d:d),D=new Float32Array(v);if(this.dataWindow){const O=Math.max(0,v-this.dataWindow.length);D.set(this.dataWindow.slice(-p+d),O)}D.set(n,v-d),this.dataWindow=D}else if(this.options.continuousWaveform){if(!this.dataWindow){const p=this.options.continuousWaveformDuration?Math.round(100*this.options.continuousWaveformDuration):((g=(c=this.wavesurfer)===null||c===void 0?void 0:c.getWidth())!==null&&g!==void 0?g:0)*window.devicePixelRatio;this.dataWindow=new Float32Array(p)}let v=0;for(let p=0;p<d;p++){const D=Math.abs(n[p]);D>v&&(v=D)}if(o+1>this.dataWindow.length){const p=new Float32Array(2*this.dataWindow.length);p.set(this.dataWindow,0),this.dataWindow=p}this.dataWindow[o]=v,o++}else this.dataWindow=n;if(this.wavesurfer){const v=((k=(_=this.dataWindow)===null||_===void 0?void 0:_.length)!==null&&k!==void 0?k:0)/100;this.wavesurfer.load("",[this.dataWindow],this.options.scrollingWaveform?this.options.scrollingWaveformWindow:v).then((()=>{this.wavesurfer&&this.options.continuousWaveform&&(this.wavesurfer.setTime(this.getDuration()/1e3),this.wavesurfer.options.minPxPerSec||this.wavesurfer.setOptions({minPxPerSec:this.wavesurfer.getWidth()/this.wavesurfer.getDuration()}))})).catch((p=>{console.error("Error rendering real-time recording data:",p)}))}}}),10);return{onDestroy:()=>{clearInterval(s),m?.disconnect(),a?.close()},onEnd:()=>{this.isWaveformPaused=!0,this.stopMic()}}}startMic(t){return ye(this,void 0,void 0,(function*(){let i;this.micStream&&this.stopMic();try{i=yield navigator.mediaDevices.getUserMedia({audio:t==null||t})}catch(m){throw new Error("Error accessing the microphone: "+m.message)}const a=this.renderMicStream(i);return this.micStream=a,this.unsubscribeDestroy=this.once("destroy",a.onDestroy),this.unsubscribeRecordEnd=this.once("record-end",a.onEnd),this.stream=i,i}))}stopMic(){var t,i,a;(t=this.micStream)===null||t===void 0||t.onDestroy(),(i=this.unsubscribeDestroy)===null||i===void 0||i.call(this),(a=this.unsubscribeRecordEnd)===null||a===void 0||a.call(this),this.micStream=null,this.unsubscribeDestroy=void 0,this.unsubscribeRecordEnd=void 0,this.stream&&(this.stream.getTracks().forEach((m=>m.stop())),this.stream=null,this.mediaRecorder=null)}startRecording(t){return ye(this,void 0,void 0,(function*(){const i=this.stream||(yield this.startMic(t));this.dataWindow=null;const a=this.mediaRecorder||new MediaRecorder(i,{mimeType:this.options.mimeType||at.find((d=>MediaRecorder.isTypeSupported(d))),audioBitsPerSecond:this.options.audioBitsPerSecond});this.mediaRecorder=a,this.stopRecording();const m=[];a.ondataavailable=d=>{d.data.size>0&&m.push(d.data),this.emit("record-data-available",d.data)};const r=d=>{var n;const o=new Blob(m,{type:a.mimeType});this.emit(d,o),this.options.renderRecordedAudio&&(this.applyOriginalOptionsIfNeeded(),this.recordedBlobUrl&&URL.revokeObjectURL(this.recordedBlobUrl),this.recordedBlobUrl=URL.createObjectURL(o),(n=this.wavesurfer)===null||n===void 0||n.load(this.recordedBlobUrl))};a.onpause=()=>r("record-pause"),a.onstop=()=>r("record-end"),a.start(this.options.mediaRecorderTimeslice),this.lastStartTime=performance.now(),this.lastDuration=0,this.duration=0,this.isWaveformPaused=!1,this.timer.start(),this.emit("record-start")}))}getDuration(){return this.duration}isRecording(){var t;return((t=this.mediaRecorder)===null||t===void 0?void 0:t.state)==="recording"}isPaused(){var t;return((t=this.mediaRecorder)===null||t===void 0?void 0:t.state)==="paused"}isActive(){var t;return((t=this.mediaRecorder)===null||t===void 0?void 0:t.state)!=="inactive"}stopRecording(){var t;this.isActive()&&((t=this.mediaRecorder)===null||t===void 0||t.stop(),this.timer.stop())}pauseRecording(){var t,i;this.isRecording()&&(this.isWaveformPaused=!0,(t=this.mediaRecorder)===null||t===void 0||t.requestData(),(i=this.mediaRecorder)===null||i===void 0||i.pause(),this.timer.stop(),this.lastDuration=this.duration)}resumeRecording(){var t;this.isPaused()&&(this.isWaveformPaused=!1,(t=this.mediaRecorder)===null||t===void 0||t.resume(),this.timer.start(),this.lastStartTime=performance.now(),this.emit("record-resume"))}static getAvailableAudioDevices(){return ye(this,void 0,void 0,(function*(){return navigator.mediaDevices.enumerateDevices().then((t=>t.filter((i=>i.kind==="audioinput"))))}))}destroy(){this.applyOriginalOptionsIfNeeded(),super.destroy(),this.stopRecording(),this.stopMic(),this.recordedBlobUrl&&(URL.revokeObjectURL(this.recordedBlobUrl),this.recordedBlobUrl=null)}applyOriginalOptionsIfNeeded(){this.wavesurfer&&this.originalOptions&&(this.wavesurfer.setOptions(this.originalOptions),delete this.originalOptions)}}var ot=e.from_html("<option> </option>"),nt=e.from_html("<option> </option>"),st=e.from_html('<select class="mic-select svelte-ym1wxn" aria-label="Select input device"><!></select>');function Ue(I,t){e.push(t,!0);let i=e.prop(t,"micDevices",15);le(()=>{if(typeof window<"u"&&navigator.mediaDevices){let n=[];ce.getAvailableAudioDevices().then(o=>{i(o),o.forEach(s=>{s.deviceId&&n.push(s)}),i(n)}).catch(o=>{o instanceof DOMException&&o.name=="NotAllowedError"&&t.onerror?.(t.i18n("audio.allow_recording_access"))})}});var a=st(),m=e.child(a);{var r=n=>{var o=ot(),s=e.child(o,!0);e.reset(o),o.value=o.__value="",e.template_effect(c=>e.set_text(s,c),[()=>t.i18n("audio.no_microphone")]),e.append(n,o)},d=n=>{var o=e.comment(),s=e.first_child(o);e.each(s,17,i,e.index,(c,g)=>{var _=nt(),k=e.child(_,!0);e.reset(_);var v={};e.template_effect(()=>{e.set_text(k,e.get(g).label),v!==(v=e.get(g).deviceId)&&(_.value=(_.__value=e.get(g).deviceId)??"")}),e.append(c,_)}),e.append(n,o)};e.if(m,n=>{!i()||i().length===0?n(r):n(d,!1)})}e.reset(a),e.template_effect(()=>a.disabled=!i()||i().length===0),e.append(I,a),e.pop()}var dt=e.from_html('<time class="duration-button duration svelte-1xuh0j1"> </time>'),lt=e.from_html('<div class="controls svelte-1xuh0j1"><div class="wrapper svelte-1xuh0j1"><button class="record record-button svelte-1xuh0j1"> </button> <button> </button> <button id="stop-paused" class="stop-button-paused svelte-1xuh0j1"> </button> <button aria-label="pause" class="pause-button svelte-1xuh0j1"><!></button> <button class="resume-button svelte-1xuh0j1"> </button> <!></div> <!></div>');function ct(I,t){e.push(t,!0);let i=e.prop(t,"recording",3,!1),a=e.prop(t,"timing",3,!1),m=e.state(e.proxy([])),r,d,n,o,s,c=e.state(!1);const g=()=>{r.style.display="none",o.style.display="flex",d.style.display="block"},_=()=>{t.record.isPaused()&&(t.record.resumeRecording(),t.record.stopRecording()),t.record.stopMic(),r.style.display="flex",o.style.display="none",d.style.display="none",r.disabled=!1},k=()=>{d.style.display="none",n.style.display="block",o.style.display="none",s.style.display="flex"},v=()=>{d.style.display="block",n.style.display="none",r.style.display="none",o.style.display="flex",s.style.display="none"};le(()=>{t.record.on("record-start",g),t.record.on("record-end",_),t.record.on("record-pause",k),t.record.on("record-resume",v)}),Ee(()=>{t.record.un("record-start",g),t.record.un("record-end",_),t.record.un("record-pause",k),t.record.un("record-resume",v)}),e.user_effect(()=>{i()&&!e.get(c)?t.record.startMic().then(()=>{t.record.startRecording(),e.set(c,!0)}):!i()&&e.get(c)&&(t.record.isPaused()&&t.record.resumeRecording(),t.record.stopRecording(),e.set(c,!1))});var p=lt(),D=e.child(p),O=e.child(D);O.__click=()=>t.record.startRecording();var j=e.child(O,!0);e.reset(O),e.bind_this(O,b=>r=b,()=>r);var u=e.sibling(O,2);u.__click=()=>{t.record.isPaused()&&(t.record.resumeRecording(),t.record.stopRecording()),t.record.stopRecording()};var P=e.child(u,!0);e.reset(u),e.bind_this(u,b=>o=b,()=>o);var A=e.sibling(u,2);A.__click=()=>{t.record.isPaused()&&(t.record.resumeRecording(),t.record.stopRecording()),t.record.stopRecording()};var z=e.child(A,!0);e.reset(A),e.bind_this(A,b=>s=b,()=>s);var W=e.sibling(A,2);W.__click=()=>t.record.pauseRecording();var E=e.child(W);Je(E),e.reset(W),e.bind_this(W,b=>d=b,()=>d);var w=e.sibling(W,2);w.__click=()=>t.record.resumeRecording();var y=e.child(w,!0);e.reset(w),e.bind_this(w,b=>n=b,()=>n);var S=e.sibling(w,2);{var B=b=>{var M=dt(),q=e.child(M,!0);e.reset(M),e.template_effect(()=>e.set_text(q,t.record_time)),e.append(b,M)};e.if(S,b=>{a()&&!t.show_recording_waveform&&b(B)})}e.reset(D);var T=e.sibling(D,2);Ue(T,{get i18n(){return t.i18n},get micDevices(){return e.get(m)},set micDevices(b){e.set(m,b,!0)}}),e.reset(p),e.template_effect((b,M,q,f,G)=>{e.set_text(j,b),e.set_class(u,1,`stop-button ${M??""}`,"svelte-1xuh0j1"),e.set_text(P,q),e.set_text(z,f),e.set_text(y,G)},[()=>t.i18n("audio.record"),()=>t.record.isPaused()?"stop-button-paused":"",()=>t.i18n("audio.stop"),()=>t.i18n("audio.stop"),()=>t.i18n("audio.resume")]),e.append(I,p),e.pop()}e.delegate(["click"]);var ut=e.from_html('<time class="trim-duration svelte-j9q3sk"> </time>'),mt=e.from_html('<time class="duration svelte-j9q3sk"> </time>'),gt=e.from_html('<time class="duration svelte-j9q3sk">0:00</time>'),_t=e.from_html('<div class="timestamps svelte-j9q3sk"><time class="time svelte-j9q3sk">0:00</time> <div><!> <!></div></div>'),vt=e.from_html('<div class="component-wrapper svelte-j9q3sk"><div class="microphone svelte-j9q3sk" data-testid="microphone-waveform"></div> <div data-testid="recording-waveform"></div> <!> <!> <!></div>');function ft(I,t){e.push(t,!0);let i=e.prop(t,"mode",15),a=e.prop(t,"waveform_options",19,()=>({show_recording_waveform:!0})),m=e.prop(t,"editable",3,!0),r=e.prop(t,"recording",3,!1),d,n=e.state(void 0),o=e.state(!1),s,c,g=e.state(void 0),_=e.state(null),k,v,p=e.state(0),D=e.state(0),O,j=e.state(!1),u=e.state(0),P=e.state(!1);const A=()=>{clearInterval(O),O=setInterval(()=>{e.update(D)},1e3)};function z(){if(A(),e.set(j,!0),t.onstartrecording?.(),a().show_recording_waveform){let l=c;l&&(l.style.display="block")}}async function W(l){e.set(D,0),e.set(j,!1),clearInterval(O);try{const R=await l.arrayBuffer(),V=await new AudioContext({sampleRate:t.waveform_settings.sampleRate}).decodeAudioData(R);V&&await De(V).then(async Y=>{await t.dispatch_blob([Y],"change"),await t.dispatch_blob([Y],"stop_recording")})}catch(R){console.error(R)}}e.user_effect(()=>{e.get(g)?.on("record-resume",()=>{A()})}),e.user_effect(()=>{e.get(n)?.on("decode",l=>{e.set(p,l,!0),v&&(v.textContent=de(l))})}),e.user_effect(()=>{e.get(n)?.on("timeupdate",l=>k&&(k.textContent=de(l)))}),e.user_effect(()=>{e.get(n)?.on("pause",()=>{t.onpause?.(),e.set(o,!1)})}),e.user_effect(()=>{e.get(n)?.on("play",()=>{t.onplay?.(),e.set(o,!0)})}),e.user_effect(()=>{e.get(n)?.on("finish",()=>{t.onstop?.(),e.set(o,!1)})});const E=()=>{c&&(c.innerHTML=""),d!==void 0&&d.destroy(),c&&(d=Re.create({...t.waveform_settings,normalize:!1,container:c}),e.set(g,d.registerPlugin(ce.create()),!0),e.get(g)?.on("record-end",W),e.get(g)?.on("record-start",z),e.get(g)?.on("record-pause",()=>{t.onpauserecording?.(),clearInterval(O)}),e.get(g)?.on("record-end",l=>{e.set(_,URL.createObjectURL(l),!0);const R=c,N=s;R&&(R.style.display="none"),N&&e.get(_)&&(N.innerHTML="",w())}),e.set(P,!0))},w=()=>{let l=s;!e.get(_)||!l||e.set(n,Re.create({container:l,url:e.get(_),...t.waveform_settings}),!0)},y=async(l,R)=>{i("edit");const N=e.get(n)?.getDecodedData();N&&await De(N,l,R).then(async V=>{await t.dispatch_blob([V],"change"),await t.dispatch_blob([V],"stop_recording"),e.get(n)?.destroy(),w()}),t.onedit?.()};le(()=>{E(),window.addEventListener("keydown",l=>{s&&s.contains(document.activeElement)&&(l.key==="ArrowRight"?We(e.get(n),.1):l.key==="ArrowLeft"&&We(e.get(n),-.1))})});var S=vt(),B=e.child(S);e.bind_this(B,l=>c=l,()=>c);var T=e.sibling(B,2);e.bind_this(T,l=>s=l,()=>s);var b=e.sibling(T,2);{var M=l=>{var R=_t(),N=e.child(R);e.bind_this(N,L=>k=L,()=>k);var V=e.sibling(N,2),Y=e.child(V);{var ie=L=>{var C=ut(),J=e.child(C,!0);e.reset(C),e.template_effect($=>e.set_text(J,$),[()=>de(e.get(u))]),e.append(L,C)};e.if(Y,L=>{i()==="edit"&&e.get(u)>0&&L(ie)})}var he=e.sibling(Y,2);{var ue=L=>{var C=mt(),J=e.child(C,!0);e.reset(C),e.template_effect($=>e.set_text(J,$),[()=>de(e.get(D))]),e.append(L,C)},me=L=>{var C=gt();e.bind_this(C,J=>v=J,()=>v),e.append(L,C)};e.if(he,L=>{e.get(j)?L(ue):L(me,!1)})}e.reset(V),e.reset(R),e.append(l,R)};e.if(b,l=>{(e.get(j)||e.get(_))&&a().show_recording_waveform&&l(M)})}var q=e.sibling(b,2);{var f=l=>{{let R=e.derived(()=>de(e.get(D)));ct(l,{get record(){return e.get(g)},get i18n(){return t.i18n},get timing(){return e.get(j)},get recording(){return r()},get show_recording_waveform(){return a().show_recording_waveform},get record_time(){return e.get(R)}})}};e.if(q,l=>{e.get(P)&&!e.get(_)&&l(f)})}var G=e.sibling(q,2);{var xe=l=>{Ne(l,{get waveform(){return e.get(n)},get container(){return s},get playing(){return e.get(o)},get audio_duration(){return e.get(p)},get i18n(){return t.i18n},get editable(){return m()},interactive:!0,handle_trim_audio:y,show_redo:!0,get handle_reset_value(){return t.handle_reset_value},get waveform_options(){return a()},get trimDuration(){return e.get(u)},set trimDuration(R){e.set(u,R,!0)},get mode(){return i()},set mode(R){i(R)}})};e.if(G,l=>{e.get(n)&&e.get(_)&&l(xe)})}e.reset(S),e.append(I,S),e.pop()}var ht=e.from_html('<div class="svelte-m6ymia"></div>'),pt=e.from_html('<button><span class="record-icon svelte-m6ymia"><span class="pinger svelte-m6ymia"></span> <span class="dot svelte-m6ymia"></span></span> </button>'),bt=e.from_html('<button class="spinner-button svelte-m6ymia"><div class="icon svelte-m6ymia"><!></div> </button>'),wt=e.from_html('<button class="record-button svelte-m6ymia"><span class="record-icon svelte-m6ymia"><span class="dot svelte-m6ymia"></span></span> </button>'),yt=e.from_html('<div class="mic-wrap svelte-m6ymia"><!> <div class="controls svelte-m6ymia"><!> <!></div></div>');function Rt(I,t){e.push(t,!0);let i=e.prop(t,"recording",3,!1),a=e.prop(t,"paused_recording",3,!1),m=e.prop(t,"waveform_options",19,()=>({show_recording_waveform:!0})),r=e.prop(t,"waiting",3,!1),d,n,o,s=e.state(e.proxy([]));le(()=>{c()});const c=()=>{d!==void 0&&d.destroy(),o&&(d=Re.create({...t.waveform_settings,normalize:!1,container:o}),n=d.registerPlugin(ce.create()))};var g=yt(),_=e.child(g);{var k=u=>{var P=ht();let A;e.bind_this(P,z=>o=z,()=>o),e.template_effect(()=>A=e.set_style(P,"",A,{display:i()?"block":"none"})),e.append(u,P)};e.if(_,u=>{m().show_recording_waveform&&u(k)})}var v=e.sibling(_,2),p=e.child(v);{var D=u=>{var P=pt();P.__click=()=>{n?.stopMic(),t.stop()};var A=e.sibling(e.child(P));e.reset(P),e.template_effect(z=>{e.set_class(P,1,e.clsx(a()?"stop-button-paused":"stop-button"),"svelte-m6ymia"),e.set_text(A,` ${z??""}`)},[()=>a()?t.i18n("audio.pause"):t.i18n("audio.stop")]),e.append(u,P)},O=u=>{var P=e.comment(),A=e.first_child(P);{var z=E=>{var w=bt();w.__click=()=>{t.stop()};var y=e.child(w),S=e.child(y);Ke(S),e.reset(y);var B=e.sibling(y);e.reset(w),e.template_effect(T=>e.set_text(B,` ${T??""}`),[()=>t.i18n("audio.waiting")]),e.append(E,w)},W=E=>{var w=wt();w.__click=()=>{n?.startMic(),t.record()};var y=e.sibling(e.child(w));e.reset(w),e.template_effect(S=>e.set_text(y,` ${S??""}`),[()=>t.i18n("audio.record")]),e.append(E,w)};e.if(A,E=>{i()&&r()?E(z):E(W,!1)},!0)}e.append(u,P)};e.if(p,u=>{i()&&!r()?u(D):u(O,!1)})}var j=e.sibling(p,2);Ue(j,{get i18n(){return t.i18n},get micDevices(){return e.get(s)},set micDevices(u){e.set(s,u,!0)}}),e.reset(v),e.reset(g),e.append(I,g),e.pop()}e.delegate(["click"]);let Me;async function xt(){const{MediaRecorder:I,register:t}=await Se(async()=>{const{MediaRecorder:a,register:m}=await import("./module-C85Cvh0Z.js");return{MediaRecorder:a,register:m}},__vite__mapDeps([0,1]),import.meta.url),{connect:i}=await Se(async()=>{const{connect:a}=await import("./module-B5lWqP2v.js");return{connect:a}},__vite__mapDeps([2,1]),import.meta.url);return t(await i()),Me=I,Me}var kt=e.from_html("<!> <!>",1),Wt=e.from_html("<!> <!>",1),Dt=e.from_html("<!> <div><!> <!> <!></div>",1);function Pt(I,t){e.push(t,!0);let i=e.prop(t,"value",15,null),a=e.prop(t,"subtitles",3,null),m=e.prop(t,"show_label",3,!0),r=e.prop(t,"buttons",19,()=>["download","share"]),d=e.prop(t,"on_custom_button_click",3,null),n=e.prop(t,"sources",19,()=>["microphone","upload"]),o=e.prop(t,"pending",3,!1),s=e.prop(t,"streaming",3,!1),c=e.prop(t,"trim_region_settings",19,()=>({})),g=e.prop(t,"waveform_options",19,()=>({})),_=e.prop(t,"dragging",15,!1),k=e.prop(t,"active_source",15,"microphone"),v=e.prop(t,"handle_reset_value",3,()=>{}),p=e.prop(t,"editable",3,!0),D=e.prop(t,"max_file_size",3,null),O=e.prop(t,"stream_every",3,.1),j=e.prop(t,"uploading",15,!1),u=e.prop(t,"recording",15,!1),P=e.prop(t,"class_name",3,""),A=e.prop(t,"upload_promise",15),z=e.prop(t,"initial_value",15),W=e.prop(t,"playback_position",15),E=e.prop(t,"time_limit",3,null),w=e.prop(t,"stream_state",3,"closed");e.user_effect(()=>{t.ondrag?.(_())});let y,S=e.state(""),B,T=[],b=!1,M=!1,q;const f=44;let G=[];typeof window<"u"&&s()&&xt().then(h=>{q=h});const l=h=>h.map(x=>x instanceof Blob?x:x.slice()),R=async(h,x)=>{let H=new File(l(h),"audio.wav",{type:"audio/wav"});if(H.size===0)return;const K=await Ye([H],x==="stream");z(i()),i((await t.upload(K,t.root,void 0,D()||void 0))?.filter(Boolean)[0]),x==="stream"?t.onstream?.(i()):x==="change"?t.onchange?.(i()):x==="stop_recording"&&t.onstop_recording?.()};Ee(()=>{s()&&y&&y.state!=="inactive"&&y.stop()});async function N(){let h;try{h=await navigator.mediaDevices.getUserMedia({audio:!0})}catch(x){if(!navigator.mediaDevices){t.onerror?.(t.i18n("audio.no_device_support"));return}if(x instanceof DOMException&&x.name=="NotAllowedError"){t.onerror?.(t.i18n("audio.allow_recording_access"));return}throw x}h!=null&&(s()?(y=new q(h,{mimeType:"audio/wav"}),y.addEventListener("dataavailable",V)):(y=new MediaRecorder(h),y.addEventListener("dataavailable",x=>{G.push(x.data)})),y.addEventListener("stop",async()=>{u(!1),y.stop(),await R(G,"change"),await R(G,"stop_recording"),G=[]}),M=!0)}async function V(h){let x=await h.data.arrayBuffer(),H=new Uint8Array(x);if(B||(B=new Uint8Array(x.slice(0,f)),H=new Uint8Array(x.slice(f))),o())T.push(H);else{let K=[B].concat(T,[H]);if(!u()||w()==="waiting")return;R(K,"stream"),T=[]}}e.user_effect(()=>{if(b&&o()===!1&&(b=!1,B&&T)){let h=[B].concat(T);T=[],R(h,"stream")}});async function Y(){u(!0),t.onstart_recording?.(),M||await N(),B=void 0,s()&&y.state!="recording"&&y.start(O()*1e3)}function ie(){t.onchange?.(null),t.onclear?.(),e.set(S,""),i(null)}function he(h){i(h),t.onchange?.(h),t.onupload?.(h)}async function ue(){u(!1),s()&&(t.onclose_stream?.(),t.onstop_recording?.(),y.stop(),o()&&(b=!0),R(G,"stop_recording"),t.onclear?.(),e.set(S,""))}e.user_effect(()=>{!u()&&y&&ue()}),e.user_effect(()=>{u()&&y&&Y()});var me=Dt(),L=e.first_child(me);{let h=e.derived(()=>k()==="upload"&&i()===null),x=e.derived(()=>t.label||t.i18n("audio.audio"));Qe(L,{get show_label(){return m()},get Icon(){return Xe},get float(){return e.get(h)},get label(){return e.get(x)}})}var C=e.sibling(L,2),J=e.child(C);qe(J,{get time_limit(){return E()}});var $=e.sibling(J,2);{var Ie=h=>{var x=e.comment(),H=e.first_child(x);{var K=F=>{var ee=kt(),Q=e.first_child(ee);Pe(Q,{get i18n(){return t.i18n},onclear:ie});var oe=e.sibling(Q,2);{var X=U=>{{let te=e.derived(()=>w()==="waiting");Rt(U,{record:Y,get recording(){return u()},stop:ue,get i18n(){return t.i18n},get waveform_settings(){return t.waveform_settings},get waveform_options(){return g()},get waiting(){return e.get(te)}})}},Z=U=>{ft(U,{get i18n(){return t.i18n},get editable(){return p()},get recording(){return u()},dispatch_blob:R,get waveform_settings(){return t.waveform_settings},get waveform_options(){return g()},get handle_reset_value(){return v()},onstartrecording:()=>t.onstart_recording?.(),onpauserecording:()=>t.onpause_recording?.(),onstoprecording:()=>t.onstop_recording?.(),get mode(){return e.get(S)},set mode(te){e.set(S,te,!0)}})};e.if(oe,U=>{s()?U(X):U(Z,!1)})}e.append(F,ee)},ae=F=>{var ee=e.comment(),Q=e.first_child(ee);{var oe=X=>{{let Z=e.derived(()=>t.i18n("audio.drop_to_upload"));Ve(X,{filetype:"audio/aac,audio/midi,audio/mpeg,audio/ogg,audio/wav,audio/x-wav,audio/opus,audio/webm,audio/flac,audio/vnd.rn-realaudio,audio/x-ms-wma,audio/x-aiff,audio/amr,audio/*",onload:he,onerror:U=>t.onerror?.(U),get root(){return t.root},get max_file_size(){return D()},get upload(){return t.upload},get stream_handler(){return t.stream_handler},get aria_label(){return e.get(Z)},get upload_promise(){return A()},set upload_promise(U){A(U)},get dragging(){return _()},set dragging(U){_(U)},get uploading(){return j()},set uploading(U){j(U)},children:(U,te)=>{var ge=e.comment(),ne=e.first_child(ge);{var _e=se=>{var ve=e.comment(),pe=e.first_child(ve);e.snippet(pe,()=>t.children),e.append(se,ve)};e.if(ne,se=>{t.children&&se(_e)})}e.append(U,ge)},$$slots:{default:!0}})}};e.if(Q,X=>{k()==="upload"&&X(oe)},!0)}e.append(F,ee)};e.if(H,F=>{k()==="microphone"?F(K):F(ae,!1)})}e.append(h,x)},Oe=h=>{var x=Wt(),H=e.first_child(x);{let ae=e.derived(()=>r()===null||r().some(F=>typeof F=="string"&&F==="download")?i().url:null);Pe(H,{get i18n(){return t.i18n},onclear:ie,onedit:()=>{e.set(S,"edit"),t.onedit?.()},get download(){return e.get(ae)},children:(F,ee)=>{var Q=e.comment(),oe=e.first_child(Q);{var X=Z=>{var U=e.comment(),te=e.first_child(U);e.each(te,17,r,e.index,(ge,ne)=>{var _e=e.comment(),se=e.first_child(_e);{var ve=re=>{var fe=e.comment(),je=e.first_child(fe);{var Le=be=>{tt(be,{get i18n(){return t.i18n},get onerror(){return t.onerror},onshare:()=>{},formatter:async we=>!we||!we.url?"":`<audio controls src="${await Fe(we.url)}"></audio>`,get value(){return i()}})};e.if(je,be=>{e.get(ne)==="share"&&be(Le)})}e.append(re,fe)},pe=re=>{$e(re,{get button(){return e.get(ne)},on_click:fe=>{d()&&d()(fe)}})};e.if(se,re=>{typeof e.get(ne)=="string"?re(ve):re(pe,!1)})}e.append(ge,_e)}),e.append(Z,U)};e.if(oe,Z=>{i()!==null&&r()&&Z(X)})}e.append(F,Q)},$$slots:{default:!0}})}var K=e.sibling(H,2);{let ae=e.derived(()=>Array.isArray(a())?a():a()?.url);He(K,{get value(){return i()},get subtitles(){return e.get(ae)},get label(){return t.label},get i18n(){return t.i18n},dispatch_blob:R,get waveform_settings(){return t.waveform_settings},get waveform_options(){return g()},get trim_region_settings(){return c()},get handle_reset_value(){return v()},get editable(){return p()},get loop(){return t.loop},interactive:!0,get onstop(){return t.onstop},get onplay(){return t.onplay},get onpause(){return t.onpause},get onedit(){return t.onedit},get mode(){return e.get(S)},set mode(F){e.set(S,F,!0)},get playback_position(){return W()},set playback_position(F){W(F)}})}e.append(h,x)};e.if($,h=>{i()==null||s()?h(Ie):h(Oe,!1)})}var Te=e.sibling($,2);Ze(Te,{get sources(){return n()},handle_clear:ie,get active_source(){return k()},set active_source(h){k(h)}}),e.reset(C),e.template_effect(()=>{e.set_class(C,1,`audio-container ${P()??""}`,"svelte-ocxd3m"),e.set_attribute(C,"data-testid",t.label?"waveform-"+t.label:"unlabelled-audio")}),e.append(I,me),e.pop()}var St=e.from_html("<!> <!>",1),At=e.from_html("<!> <!>",1);function qt(I,t){e.push(t,!0);let i=e.rest_props(t,["$$slots","$$events","$$legacy"]),a=e.state(void 0);t.props.stream_every=.1;class m extends ze{async get_data(){return e.get(a)&&(await e.get(a),await Ce()),await super.get_data()}}const r=new m(i);let d=e.derived(()=>r.shared.label||r.i18n("audio.audio")),n=e.derived(()=>t.minimal??r.props.minimal??!1),o=e.derived(()=>r.props.sources?r.props.sources[0]:null),s=e.state(e.proxy(r.props.value));const c=()=>{e.get(s)===null||r.props.value===e.get(s)||(r.props.value=e.get(s))};let g=e.state(!1),_=e.state(e.proxy(r.props.recording??!1));e.user_effect(()=>{r.props.recording=e.get(_)});let k="darkorange",v=e.proxy({height:50,barWidth:2,barGap:3,cursorWidth:2,cursorColor:"#ddd5e9",autoplay:r.props.autoplay,barRadius:10,dragToSeek:!0,normalize:!0,minPxPerSec:20,waveColor:r.props.waveform_options.waveform_color||"#9ca3af",progressColor:r.props.waveform_options.waveform_progress_color||k,mediaControls:r.props.waveform_options.show_controls??!1,sampleRate:r.props.waveform_options.sample_rate||44100});const p={color:r.props.waveform_options.trim_region_color,drag:!0,resize:!0};function D(){document.documentElement.style.setProperty("--trim-region-color",p.color||k)}function O(W){const[E,w]=W.includes("Invalid file type")?["warning","complete"]:["error","error"];r.shared.loading_status&&(r.shared.loading_status.status=w,r.shared.loading_status.message=W),r.dispatch(E,W)}let j=e.state(e.proxy(r.props.value));e.user_effect(()=>{e.get(j)!=r.props.value&&(e.set(j,r.props.value,!0),r.dispatch("change"))}),le(()=>{D()});var u=e.comment(),P=e.first_child(u);{var A=W=>{{let E=e.derived(()=>e.get(g)?"focus":"base");Ae(W,{variant:"solid",get border_mode(){return e.get(E)},padding:!1,allow_overflow:!1,get elem_id(){return r.shared.elem_id},get elem_classes(){return r.shared.elem_classes},get visible(){return r.shared.visible},get container(){return r.shared.container},get scale(){return r.shared.scale},get min_width(){return r.shared.min_width},children:(w,y)=>{var S=St(),B=e.first_child(S);ke(B,e.spread_props({get autoscroll(){return r.shared.autoscroll},get i18n(){return r.i18n}},()=>r.shared.loading_status,{on_clear_status:()=>r.dispatch("clear_status",r.shared.loading_status)}));var T=e.sibling(B,2);{let b=e.derived(()=>r.props.buttons??["download","share"]);Ge(T,{get i18n(){return r.i18n},get show_label(){return r.shared.show_label},get buttons(){return e.get(b)},get value(){return r.props.value},get subtitles(){return r.props.subtitles},get label(){return e.get(d)},get loop(){return r.props.loop},get waveform_settings(){return v},get waveform_options(){return r.props.waveform_options},get editable(){return r.props.editable},get minimal(){return e.get(n)},on_custom_button_click:M=>{r.dispatch("custom_button_click",{id:M})},onshare:M=>r.dispatch("share",M),onerror:M=>r.dispatch("error",M.detail),onplay:()=>r.dispatch("play"),onpause:()=>r.dispatch("pause"),onstop:()=>r.dispatch("stop"),get playback_position(){return r.props.playback_position},set playback_position(M){r.props.playback_position=M}})}e.append(w,S)},$$slots:{default:!0}})}},z=W=>{{let E=e.derived(()=>r.props.value===null&&e.get(o)==="upload"?"dashed":"solid"),w=e.derived(()=>e.get(g)?"focus":"base");Ae(W,{get variant(){return e.get(E)},get border_mode(){return e.get(w)},padding:!1,allow_overflow:!1,get elem_id(){return r.shared.elem_id},get elem_classes(){return r.shared.elem_classes},get visible(){return r.shared.visible},get container(){return r.shared.container},get scale(){return r.shared.scale},get min_width(){return r.shared.min_width},children:(y,S)=>{var B=At(),T=e.first_child(B);ke(T,e.spread_props({get autoscroll(){return r.shared.autoscroll},get i18n(){return r.i18n}},()=>r.shared.loading_status,{on_clear_status:()=>r.dispatch("clear_status",r.shared.loading_status)}));var b=e.sibling(T,2);{let M=e.derived(()=>r.props.buttons??[]),q=e.derived(()=>e.get(o)||void 0);Pt(b,{get label(){return e.get(d)},get show_label(){return r.shared.show_label},get buttons(){return e.get(M)},on_custom_button_click:f=>{r.dispatch("custom_button_click",{id:f})},get value(){return r.props.value},get subtitles(){return r.props.subtitles},onchange:f=>r.props.value=f,onstream:f=>{r.props.value=f,r.dispatch("stream",r.props.value)},ondrag:f=>e.set(g,f,!0),get root(){return r.shared.root},get sources(){return r.props.sources},get active_source(){return e.get(q)},get pending(){return r.shared.loading_status.pending},get streaming(){return r.props.streaming},get loop(){return r.props.loop},get max_file_size(){return r.shared.max_file_size},handle_reset_value:c,get editable(){return r.props.editable},onedit:()=>r.dispatch("edit"),onplay:()=>r.dispatch("play"),onpause:()=>r.dispatch("pause"),onstop:()=>r.dispatch("stop"),onstart_recording:()=>r.dispatch("start_recording"),onpause_recording:()=>r.dispatch("pause_recording"),onstop_recording:()=>{r.dispatch("stop_recording"),r.dispatch("input")},onupload:()=>{r.dispatch("upload"),r.dispatch("input")},onclear:()=>{r.dispatch("clear"),r.dispatch("input")},onerror:O,onclose_stream:()=>r.dispatch("close_stream","stream"),get i18n(){return r.i18n},get waveform_settings(){return v},get waveform_options(){return r.props.waveform_options},get trim_region_settings(){return p},get stream_every(){return r.props.stream_every},get stream_state(){return r.shared.loading_status.stream_state},upload:(...f)=>r.shared.client.upload(...f),stream_handler:(...f)=>r.shared.client.stream(...f),get time_limit(){return r.shared.loading_status.time_limit},get upload_promise(){return e.get(a)},set upload_promise(f){e.set(a,f,!0)},get initial_value(){return e.get(s)},set initial_value(f){e.set(s,f,!0)},get recording(){return e.get(_)},set recording(f){e.set(_,f,!0)},get dragging(){return e.get(g)},set dragging(f){e.set(g,f,!0)},get playback_position(){return r.props.playback_position},set playback_position(f){r.props.playback_position=f},children:(f,G)=>{et(f,{get i18n(){return r.i18n},type:"audio"})},$$slots:{default:!0}})}e.append(y,B)},$$slots:{default:!0}})}};e.if(P,W=>{r.shared.interactive?W(z,!1):W(A)})}e.append(I,u),e.pop()}export{qt as I,Pt as a,ce as o};
